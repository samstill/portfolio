import{m as D,d as i,j as e,T as U,b as F,k as M,u as O,r as s,y as _,O as A,_ as L,t as q,i as H,$ as K}from"./index-DMA27xvW.js";import{n as Q,Q as Y,R as J}from"./index-DSFE_B1z.js";import{F as V}from"./FirebaseEventRepository-DXw_iLH6.js";import{c as m}from"./index-e2yIpbwy.js";import{m as x}from"./proxy-BDBy7vtW.js";import"./iconBase-BGw-mJW2.js";const p=D`
  0% {
    background-position: -468px 0;
  }
  100% {
    background-position: 468px 0;
  }
`,G=i.div`
  max-width: 600px;
  margin: 0 auto;
`,W=i(x.div)`
  width: 120px;
  height: 36px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      rgba(255, 255, 255, 0) 100%
    );
    animation: ${p} 1.5s infinite;
  }
`,X=i(x.div)`
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  border: 1px solid rgba(255, 255, 255, 0.18);
`,Z=i.div`
  width: 60%;
  height: 36px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  margin: 0 auto 30px;
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      rgba(255, 255, 255, 0) 100%
    );
    animation: ${p} 1.5s infinite;
  }
`,ee=i.div`
  display: flex;
  gap: 20px;
  margin: 30px 0;

  @media (max-width: 768px) {
    flex-direction: column;
  }
`,j=i.div`
  flex: 1;
  height: 100px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      rgba(255, 255, 255, 0) 100%
    );
    animation: ${p} 1.5s infinite;
  }
`,te=i.div`
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
`,h=i.div`
  display: flex;
  justify-content: space-between;
  margin: 10px 0;
  
  .label {
    width: 100px;
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    position: relative;
    overflow: hidden;

    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.1) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      animation: ${p} 1.5s infinite;
    }
  }

  .value {
    width: 80px;
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    position: relative;
    overflow: hidden;

    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.1) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      animation: ${p} 1.5s infinite;
    }
  }
`,ae=i.div`
  width: 100%;
  height: 50px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  margin-top: 20px;
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      rgba(255, 255, 255, 0) 100%
    );
    animation: ${p} 1.5s infinite;
  }
`,ie=()=>e.jsxs(G,{children:[e.jsx(W,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5}}),e.jsxs(X,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(j,{}),e.jsx(j,{})]}),e.jsxs(te,{children:[e.jsxs(h,{children:[e.jsx("div",{className:"label"}),e.jsx("div",{className:"value"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"label"}),e.jsx("div",{className:"value"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"label"}),e.jsx("div",{className:"value"})]})]}),e.jsx(ae,{})]})]}),re=()=>new Promise(a=>{const d=document.createElement("script");d.src="https://checkout.razorpay.com/v1/checkout.js",d.onload=()=>a(!0),d.onerror=()=>a(!1),document.body.appendChild(d)}),b=i.div`
  min-height: 100vh;
  padding: 80px 20px;
  background: ${a=>a.theme.background};

  @media (max-width: 768px) {
    padding: 60px 15px;
  }
`,ne=i(x.div)`
  max-width: 600px;
  margin: 0 auto;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  border: 1px solid rgba(255, 255, 255, 0.18);

  @media (max-width: 768px) {
    padding: 20px;
  }
`,oe=i.h1`
  font-size: 1.8rem;
  color: ${a=>a.theme.text};
  margin-bottom: 20px;
  text-align: center;
`,se=i.div`
  display: flex;
  gap: 20px;
  margin: 30px 0;

  @media (max-width: 768px) {
    flex-direction: column;
  }
`,S=i(x.button)`
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 20px;
  background: ${a=>a.$selected?"linear-gradient(135deg, #6e8efb, #4a6cf7)":"rgba(255, 255, 255, 0.1)"};
  border: none;
  border-radius: 12px;
  cursor: pointer;
  color: ${a=>a.theme.text};
  transition: all 0.3s ease;

  svg {
    font-size: 24px;
  }

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
`,de=i.div`
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;

  .price-row {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
    color: ${a=>a.theme.text};
  }

  .total {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 10px;
    padding-top: 10px;
    font-weight: bold;
  }
`,ce=i(x.button)`
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #6e8efb, #4a6cf7);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 500;
  cursor: pointer;
  margin-top: 20px;

  &:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }
`,le=i(x.button)`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 8px;
  color: ${a=>a.theme.text};
  cursor: pointer;
  margin-bottom: 20px;
  font-size: 0.9rem;
`,pe=()=>{const a=Date.now(),d=Math.random().toString(36).substr(2,6).toUpperCase();return`TKT-${a}-${d}`},xe=()=>Math.random().toString(36).substr(2,9).toUpperCase(),ke=()=>{var w;const{id:a}=U(),d=F(),P=M(),{currentUser:c}=O(),[t,I]=s.useState(null),[T,$]=s.useState(!0),[u,f]=s.useState("CARD"),[v,y]=s.useState(!1),[k,C]=s.useState(0),[ge,E]=s.useState(0),[r,ue]=s.useState(((w=P.state)==null?void 0:w.quantity)||1),[z,N]=s.useState(!1);s.useEffect(()=>{(async()=>{if(a)try{const l=await new V().getEvent(a);I(l)}catch(n){console.error("Error fetching event:",n),m.error("Failed to load event details")}finally{$(!1)}})()},[a]),s.useEffect(()=>{if(!(t!=null&&t.id))return;const o=_.subscribeToTicketCount(t.id,(n,l)=>{C(n),E(l)});return()=>o()},[t==null?void 0:t.id]),s.useEffect(()=>{(async()=>{const n=await re();N(n)})()},[]);const R=async()=>{if(!(!t||!c)){y(!0);try{const o=await B(),n={eventId:t.id,userId:c.uid,ticketNumber:pe(),verificationCode:xe(),transactionId:o.transactionId,paymentMode:u,amountPaid:t.price*r,quantity:r,status:"valid",purchasedAt:new Date().toISOString(),eventDetails:{title:t.title,date:t.date,location:t.location,...t.imageUrl&&{imageUrl:t.imageUrl}}},l=await A.createTicket(n);m.success("Ticket booked successfully!"),d(`/tickets/${l.id}`)}catch(o){console.error("Error after payment:",o);try{await L(q(H,"failed_transactions"),{userId:c.uid,eventId:t.id,error:o.message,timestamp:K(),quantity:r,amount:t.price*r})}catch(n){console.error("Failed to record failed transaction:",n)}m.error(o.message||"Payment failed"),d("/payment-error",{state:{error:o,eventId:t.id,paymentId:o.paymentId}})}finally{y(!1)}}},B=async()=>{if(!t||!c)throw new Error("Missing event or user data");return new Promise((o,n)=>{const l={key:"rzp_test_KJSqoIIfYu0tq5",amount:t.price*r*100,currency:"INR",name:t.title,description:`${r} ticket(s) for ${t.title}`,handler:function(g){g.razorpay_payment_id?o({success:!0,transactionId:g.razorpay_payment_id}):n(new Error("Payment failed"))},modal:{ondismiss:function(){n(new Error("Payment cancelled by user"))}},prefill:{name:c.displayName||void 0,email:c.email||void 0,contact:c.phoneNumber||void 0},notes:{eventId:t.id,quantity:r,userId:c.uid},theme:{color:"#4a6cf7"}};try{new window.Razorpay(l).open()}catch(g){n(g)}})};return T?e.jsx(b,{children:e.jsx(ie,{})}):t?e.jsxs(b,{children:[e.jsxs(le,{onClick:()=>d(`/events/${a}`),whileHover:{x:-5},whileTap:{scale:.95},children:[e.jsx(Q,{size:18}),"Back to Event"]}),e.jsxs(ne,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(oe,{children:"Book Tickets"}),e.jsxs(se,{children:[e.jsxs(S,{$selected:u==="CARD",onClick:()=>f("CARD"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(Y,{size:24}),"Card Payment"]}),e.jsxs(S,{$selected:u==="UPI",onClick:()=>f("UPI"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(J,{size:24}),"UPI Payment"]})]}),e.jsxs(de,{children:[e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Ticket Price"}),e.jsxs("span",{children:["₹",t.price," × ",r]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",t.price*r]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Booking Fee"}),e.jsxs("span",{children:["₹",Math.round(t.price*r*.02)]})]}),e.jsxs("div",{className:"price-row total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",t.price*r+Math.round(t.price*r*.02)]})]})]}),e.jsx(ce,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:R,disabled:v||!z||!t||!c||k<r,children:v?"Processing...":k<r?"Not enough tickets":"Proceed to Pay"})]})]}):e.jsx(b,{children:e.jsx("div",{children:"Event not found"})})};export{ke as BookingScreen,ke as default};
